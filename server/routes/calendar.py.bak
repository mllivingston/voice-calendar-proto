from fastapi import APIRouter
from ai.schema import Command
from calendarsvc.tools import apply, MutateError

router = APIRouter(prefix="/calendar", tags=["calendar"])

@router.post("/mutate")
async def post_mutate(cmd: Command):
    if cmd.needs_clarification:
        return {"status":"needs_clarification", "question": cmd.clarification_question}
    try:
        result = apply(cmd)
        return {"status":"ok", **result}
    except MutateError as e:
        return {"status":"error", "error": str(e)}
